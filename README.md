# SensorLib test Manual

This manual specifies how to build, link with python and test SensorLib library.  
Tested platforms: cygwin   

## Required tools:

The following cygwin packets are required of the latest version available from cygwin distribution:  
cmake*  
gcc*  
make*,
python39  
python39-pytest*   
python39-sip  
The following python packages are required to be installed through pip tool:  
setuptools  
wheel  
The following additional tools are required:  
MSVC VS 20xx C++ x64/86 build tools  
Windows 10 SDK all packets  
Paths to cygwin.dll and tools shall be added to PATH variable   

## How to build:

All steps are automated in build.sh script. Below is the list of steps to execute them manually.  
1. From SensorLib\lib folder execute   
    <cmake .>  
This will generate make environment  
2. Execute  
    <make>  
This will build the target library libStateReporterLib.a  
3. Rename or copy libStateReporterLib.a to libStateReporterLib.lib  
    cp libStateReporterLib.a libStateReporterLib.lib  
The following commands shall be executed from Sensorlib folder. They will build python interface around C library  
4. sip-build --verbose  
As a result build folder will be created  
5. sip-install  
As result  Sensorlibrary will be installed in python on the workstation and can be used from other python modules  
in the form of   
import sensorlib  

## Tests structure:

Test suite is located in test folder.   
TWO test functions of TestSensor class are stored in test_ex1.py
  test_sensor - tests the incoming message after single call of sensorlib.StateReporter_set_value function 
  test_sensor_multiple_messages - tests multiple messages (shall be exactly 4) after 4 calls of sensorlib.StateReporter_set_value  
  This function was desinged, assuming that current implementation of sensorlib.StateReporter_set_value is correct,  
  specifically the feature of periodically message sending after each call of sensorlib.StateReporter_set_value with the new function name  
Test vectors are stored in sensor_data.py.  
  sensor_data list stores test vector for test_sensor function.  
Each test vector is the instance of SensorIdEntry dataclass  
field listed in order of initialization:   
val - bytes string  - actual value to be set in the library in the string format  
message_fileds - instance of TransmitFields class containing   
  func - function name  
  desc - descriptor name  
expected_result - enum value of Expected state, returned by the library  
New test vector can be added by copying one of existing lines in the initialization of sensor_data and modifying corresponding values  
  sensor_multiple_data stores test vectors for test_sensor_multiple_messages test function  
Each entry of the list is the list of exaclty 4 instances of SensorIdEntry dataclass  
message_fileds.func member must have the following value for each of 4 instances correspondingly  
  ('func1', 'func2', 'func3', 'func4')  
Order must be preserved  
This limitation is beacuse of the sensor library feature, described in the previous section  

## To run test suite:

1. Navigate to tests folder.  
Each of the test functions must be run through separate call of test suite. This is because of the limitation, that sensor library  
doesn't produce messages, if it is stopped and the initialized again within the same session  
2. To run the complete test suite of test_sensor function issue the following command.  
python -m pytest -s test_ex1.py::TestSensor::test_sensor  
3. To run specific test issue the following command  
python -m pytest test_ex1.py::TestSensor::test_sensor -k '[sensor_entry<x>]'  
where x is the number of desired entry in sensor_data list, starting from zero.   
-k pytest selector also allows to select other group of tests by matching between it's string parameter  
and test name, generated by pytest.  
3. To run the complete test suite of test_sensor_multiple_messages function issue the following command.  
python -m pytest -s test_ex1.py::TestSensor::test_sensor:::test_sensor_multiple_messages  
4. To run specific test issue the following command  
python -m pytest test_ex1.py::TestSensor::test_sensor_multiple_messages -k '[sensor_entry<x>]'  
where x is the number of desired entry in sensor_data list, starting from zero.   
-k pytest selector also allows to select other group of tests by matching between it's string parameter  
and test name, generated by pytest.  


